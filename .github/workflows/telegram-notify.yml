name: Notify Telegram on README Update

on:
  workflow_dispatch:
  push:
    paths:
      - README.md

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Get first line of README.md
        id: get_first_line
        run: |
          echo "FIRST_LINE=$(head -n 1 README.md | cut -c 3-)" >> $GITHUB_ENV

      - name: Send message to Telegram
        if: env.FIRST_LINE != ''
        run: |
          curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -H "Content-Type: application/json" \
          -d '{"chat_id": "${{ secrets.TELEGRAM_CHANNEL_ID }}", "text": "'"$(echo "${{ env.FIRST_LINE }}" | sed 's/-/\\-/g')"'", "parse_mode": "MarkdownV2"}'
